<!doctype html>
<html>
<!-- AMP Web Push Helper IFrame -->

<head>
  <meta charset="utf-8">
  <!--
    Minified script bundle of helper-frame.js, window-messenger.js, and
    worker-messenger.js.
  -->
  <script>
    var WorkerMessengerReplyBuffer=function(){function e(){this.replies={}}return e.prototype.addListener=function(e,n,t){var o={callback:n,onceListenerOnly:t}
this.findListenersForMessage(e).length>0?this.replies[""+e].push(o):this.replies[""+e]=[o]},e.prototype.findListenersForMessage=function(e){return this.replies[""+e]||[]},e.prototype.deleteListenerRecords=function(e){this.replies[""+e]=null},e.prototype.deleteListenerRecord=function(e,n){for(var t=this.replies[""+e],o=t.length-1;o>=0;o--){var r=t[o]
r===n&&t.splice(o,1)}},e}(),WorkerMessenger=function(){function e(e){this.replies=new WorkerMessengerReplyBuffer,this.debug=!!e&&e.debug}return e.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n]
if(this.debug){var t=location.origin+":",o=Array.prototype.concat.apply([t],arguments)
console.log.apply(this,o)}},e.prototype.unicast=function(e,n){var t=this
return this.isWorkerControllingPage()||this.log("[Worker Messenger] The iframe is not controlled by the service worker yet. Waiting to unicast..."),this.waitUntilWorkerControlsPage().then(function(){t.log("[Worker Messenger] [IFrame -> SW] Unicasting "+("'"+e+"' to service worker.")),navigator.serviceWorker.controller.postMessage({command:e,payload:n})})},e.prototype.listen=function(){this.isWorkerControllingPage()||this.log("[Worker Messenger] The iframe is not controlled by the service worker yet. Waiting to listen...")
var e=this
return this.waitUntilWorkerControlsPage().then(function(){e.log("[Worker Messenger] The iframe is now controlled by the service worker."),navigator.serviceWorker.addEventListener("message",e.onPageMessageReceivedFromServiceWorker.bind(e)),e.log("[Worker Messenger] IFrame is now listening for messages.")})},e.prototype.onPageMessageReceivedFromServiceWorker=function(e){var n=e.data,t=this.replies.findListenersForMessage(n.command),o=[],r=[]
this.log("[Worker Messenger] IFrame received message:",e.data)
for(var i=0,s=t;i<s.length;i++){var a=s[i]
a.onceListenerOnly&&o.push(a),r.push(a)}for(var c=o.length-1;c>=0;c--){var a=o[c]
this.replies.deleteListenerRecord(n.command,a)}for(var g=0,l=r;g<l.length;g++){var a=l[g]
a.callback.apply(null,[n.payload])}},e.prototype.on=function(e,n){this.replies.addListener(e,n,!1)},e.prototype.once=function(e,n){this.replies.addListener(e,n,!0)},e.prototype.off=function(e){this.replies.deleteListenerRecords(e)},e.prototype.isWorkerControllingPage=function(){return navigator.serviceWorker&&navigator.serviceWorker.controller&&"activated"===navigator.serviceWorker.controller.state},e.prototype.waitUntilWorkerControlsPage=function(){var e=this
return new Promise(function(n){e.isWorkerControllingPage()?n():navigator.serviceWorker.addEventListener("controllerchange",function(t){e.isWorkerControllingPage()?n():navigator.serviceWorker.controller.addEventListener("statechange",function(t){e.isWorkerControllingPage()&&n()})})})},e}(),WindowMessenger=function(){function e(e){e||(e={}),this.messages={},this.listeners={},this.debug=e.debug,this.listening=!1,this.connecting=!1,this.connected=!1,this.channel=null,this.messagePort=null,this.onListenConnectionMessageReceivedProc=null,this.onConnectConnectionMessageReceivedProc=null,this.onChannelMessageReceivedProc=null}return e.prototype.listen=function(n){var t=this
return new Promise(function(e,o){return t.connected?void o(Error("Already connected.")):t.listening?void o(Error("Already listening for connections.")):Array.isArray(n)?(t.onListenConnectionMessageReceivedProc=t.onListenConnectionMessageReceived.bind(t,n,e,o),window.addEventListener("message",t.onListenConnectionMessageReceivedProc),void t.log("Listening for a connection message...")):void o(Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",n))}).then(function(){t.send(e.Topics.CONNECT_HANDSHAKE,null),t.connected=!0,t.log("Messenger channel to "+origin+" established.")})},e.prototype.isAllowedOrigin=function(e,n){for(var t=new URL(e).origin,o=0,r=n;o<r.length;o++){var i=r[o]
if(new URL(i).origin===t)return!0}return!1},e.prototype.onListenConnectionMessageReceived=function(n,t,o,r){var i=r.data,s=r.origin,a=r.ports
return this.log("Window message for listen() connection received:",i),this.isAllowedOrigin(s,n)?i&&i.topic===e.Topics.CONNECT_HANDSHAKE?(this.log("Received expected connection handshake message:",i),window.removeEventListener("message",this.onListenConnectionMessageReceivedProc),this.messagePort=a[0],this.onChannelMessageReceivedProc=this.onChannelMessageReceived.bind(this),this.messagePort.addEventListener("message",this.onChannelMessageReceivedProc,!1),this.messagePort.start(),void t()):void this.log("Discarding connection message because it did not contain our expected handshake:",i):void this.log("Discarding connection message from "+s+" because it isn't an allowed origin:",i," (allowed origins are)",n)},e.prototype.connect=function(n,t){var o=this
return new Promise(function(r,i){return n||i(Error("Provide a valid Window context to connect to.")),t||i(Error("Provide an expected origin for the remote Window or provide the wildcard *.")),o.connected?void i(Error("Already connected.")):o.connecting?void i(Error("Already connecting.")):(o.channel=new MessageChannel,o.messagePort=o.channel.port1,o.onConnectConnectionMessageReceivedProc=o.onConnectConnectionMessageReceived.bind(o,o.messagePort,t,r,i),o.messagePort.addEventListener("message",o.onConnectConnectionMessageReceivedProc),o.messagePort.start(),n.postMessage({topic:e.Topics.CONNECT_HANDSHAKE},"*"===t?"*":new URL(t).origin,[o.channel.port2]),void o.log("Opening message channel to "+t+"..."))})},e.prototype.onConnectConnectionMessageReceived=function(e,n,t,o){this.connected=!0,this.log("Messenger channel to "+n+" established."),e.removeEventListener("message",this.onConnectConnectionMessageReceivedProc),this.onChannelMessageReceivedProc=this.onChannelMessageReceived.bind(this),e.addEventListener("message",this.onChannelMessageReceivedProc,!1),t()},Object.defineProperty(e,"Topics",{get:function(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",AMP_EXTENSION_CONFIG:"topic-amp-extension-config",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SUBSCRIPTION_STATE:"topic-subscription-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SUBSCRIBING:"topic-subscribing",PERMISSION_DIALOG_SHOWN:"topic-permission-dialog-shown",NOTIFICATION_PERMISSION_RESULT:"topic-notification-permission-result",UNSUBSCRIBING:"topic-unsubscribing",SERVICE_WORKER_QUERY:"topic-service-worker-query"}},enumerable:!0,configurable:!0}),e.prototype.log=function(){if(this.debug){var e=location.origin+":",n=Array.prototype.concat.apply([e],arguments)
console.log.apply(null,n)}},e.prototype.onChannelMessageReceived=function(e){var n=e.data
e.origin,e.source
if(this.messages[n.id]&&n.isReply){var t=this.messages[n.id]
delete this.messages[n.id]
var o=t.promiseResolver
t.message=n.data,this.debug&&this.log("Received reply for topic '"+n.topic+"':",n.data),o([n.data,this.sendReply.bind(this,n.id,t.topic)])}else{var r=this.listeners[n.topic]
if(!r)return
this.debug&&this.log("Received new message for topic '"+n.topic+"':",n.data)
for(var i=0,s=r;i<s.length;i++){var a=s[i]
a(n.data,this.sendReply.bind(this,n.id,n.topic))}}},e.prototype.on=function(e,n){this.listeners[e]?this.listeners[e].push(n):this.listeners[e]=[n]},e.prototype.off=function(e,n){if(n){var t=this.listeners.topic.indexOf(n);-1!==t&&this.listeners.splice(t,1)}else this.listeners[e]&&delete this.listeners[e]},e.prototype.sendReply=function(e,n,t){var o=this,r={id:e,topic:n,data:t,isReply:!0}
return this.messagePort.postMessage(r),new Promise(function(e){o.messages[r.id]={message:t,topic:n,promiseResolver:e}})},e.prototype.send=function(e,n){var t=this,o={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:e,data:n}
return this.log("Sending "+e+":",n),this.messagePort.postMessage(o),new Promise(function(r){t.messages[o.id]={message:n,topic:e,promiseResolver:r}})},e}()
"undefined"!=typeof module&&(module.exports=WindowMessenger)
var AmpWebPushHelperFrame=function(){function e(e){e&&e.debug&&(this.debug=!0),this.ampMessenger=new WindowMessenger({debug:this.debug}),this.workerMessenger=new WorkerMessenger({debug:this.debug})}return e.prototype.replyToFrameWithPayload=function(e,n,t,o){e({success:n,error:n?void 0:t,result:n?o:void 0})},e.prototype.onAmpPageMessageReceived_NotificationPermissionState=function(e,n){this.replyToFrameWithPayload(n,!0,null,Notification.permission)},e.prototype.onAmpPageMessageReceived_ServiceWorkerState=function(e,n){var t={isControllingFrame:!!navigator.serviceWorker.controller,url:navigator.serviceWorker.controller?navigator.serviceWorker.controller.scriptURL:null,state:navigator.serviceWorker.controller?navigator.serviceWorker.controller.state:null}
this.replyToFrameWithPayload(n,!0,null,t)},e.prototype.onAmpPageMessageReceived_ServiceWorkerRegistration=function(e,n){var t=this
if(!e||!e.workerUrl||!e.registrationOptions)throw Error("Expected arguments workerUrl and registrationOptions in message, got:",e)
navigator.serviceWorker.register(e.workerUrl,e.registrationOptions).then(function(e){t.replyToFrameWithPayload(n,!0,null,null)})["catch"](function(e){t.replyToFrameWithPayload(n,!0,null,e?e.message||""+e:null)})},e.prototype.onAmpPageMessageReceived_ServiceWorkerQuery=function(e,n){var t=this
if(!e||!e.topic)throw Error("Expected argument topic in message, got:",e)
this.workerMessenger.once(e.topic,function(e){return t.replyToFrameWithPayload(n,!0,null,e)}),this.workerMessenger.unicast(e.topic,e.payload)},e.prototype.tryDecodeUriComponent=function(e,n){void 0===n&&(n="")
try{return decodeURIComponent(e)}catch(t){return n}},e.prototype.parseQueryString=function(e){var n=Object.create(null)
if(!e)return n
for(var t,o=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;t=o.exec(e);){var r=this.tryDecodeUriComponent(t[1]).trim(),i=t[2]?this.tryDecodeUriComponent(t[2]).trim():""
n[r]=i}return n},e.prototype.getParentOrigin=function(){var e=this.parseQueryString(window.location.search)
if(!e.parentOrigin)throw Error("Expecting parentOrigin URL query parameter.")
return e.parentOrigin},e.prototype.run=function(){this.ampMessenger.on(WindowMessenger.Topics.NOTIFICATION_PERMISSION_STATE,this.onAmpPageMessageReceived_NotificationPermissionState.bind(this)),this.ampMessenger.on(WindowMessenger.Topics.SERVICE_WORKER_STATE,this.onAmpPageMessageReceived_ServiceWorkerState.bind(this)),this.ampMessenger.on(WindowMessenger.Topics.SERVICE_WORKER_REGISTRATION,this.onAmpPageMessageReceived_ServiceWorkerRegistration.bind(this)),this.ampMessenger.on(WindowMessenger.Topics.SERVICE_WORKER_QUERY,this.onAmpPageMessageReceived_ServiceWorkerQuery.bind(this)),this.workerMessenger.listen(),this.ampMessenger.listen([this.getParentOrigin()])},e}()
new AmpWebPushHelperFrame({debug:!0}).run()
  </script>
</head>
<body>
</body>
</html>